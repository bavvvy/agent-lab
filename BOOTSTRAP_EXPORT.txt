--- control/SYSTEM.md ---

# SYSTEM.md

## Purpose of Agent Lab
Agent Lab is a deterministic local research and reporting workspace for portfolio strategy development, validation, and publication to static web reports.

## Current architecture overview
- Core engine lives in `scientist-workspace/portfolio_engine/`.
- Backtest/report rendering lives in `scientist-workspace/backtest.py`.
- Publication orchestration is centralized in `scientist-workspace/publish.py`.
- Published artifacts are served from repository-root `reports/`.

## Directory structure summary
- `scientist-workspace/` — strategy code, backtest, publish workflow, tests.
- `reports/` — public HTML reports + `index.html` dashboard.
- `reports/archive/` — immutable timestamped report snapshots.
- `archive/` — local internal archive (not publication target).

## Report publication workflow
`scientist-workspace/publish.py` is the sole publication mechanism:
1. Runs deterministic `backtest.py` for a supported strategy.
2. Ensures report is written to `reports/<strategy>.html`.
3. Creates immutable timestamped version in `reports/`.
4. Regenerates `reports/index.html`.
5. Stages, commits, pushes to `origin/main`.
6. Verifies local/remote HEAD match.

## Report versioning rule
Timestamped report filenames must follow:
`YYYY-MM-DD_HH-MM_<strategy>.html` (UTC minute precision).

## Index rule
`reports/index.html` uses filename timestamp prefix as source of truth for:
- Published (UTC) display
- Sort order (newest first)
Non-conforming names are treated as `Legacy`.

## Public URL structure
- Dashboard: `https://bavvvy.github.io/agent-lab/reports/`
- Report page: `https://bavvvy.github.io/agent-lab/reports/<filename>.html`

## Guardrails (modifiable vs protected paths)
Modifiable:
- `scientist-workspace/`
- `reports/`

Protected / handle with care:
- `.git/`
- `archive/`

## Non-negotiable invariants
- Publication must maintain HEAD parity (`git rev-parse HEAD` == `git rev-parse origin/main`) after push.
- Published versioned reports must follow `YYYY-MM-DD_HH-MM_<strategy>.html`.
- Dashboard ordering/published timestamp must derive from filename timestamp prefix (UTC), not git commit date.
- `scientist-workspace/publish.py` remains the sole publication mechanism.

Invariant-change override phrase (required verbatim):
`OVERRIDE_INVARIANTS: I ACCEPT RISK`

MS must refuse invariant changes unless the override phrase is explicitly present in the request.

## High-level evolution roadmap
1. Add multi-strategy support in `publish.py` with explicit strategy registry.
2. Add deterministic data adapters (local snapshots) for non-synthetic backtests.
3. Expand report schema (factor attribution, exposures, rolling risk).
4. Add CI validation for report generation and index integrity.
5. Introduce strict config/version contracts across backtest and publish layers.


--- control/CONTEXT_BOOTSTRAP.md ---

# CONTEXT_BOOTSTRAP.md

## Architecture version
- 1.0

## System purpose
- Deterministic portfolio research/backtest reporting pipeline.
- Publish static reports to `reports/` for GitHub Pages delivery.

## Publication workflow summary
- Use `scientist-workspace/publish.py` (single publication entrypoint).
- Run backtest for strategy, regenerate `reports/index.html`, commit/push, verify HEAD parity.

## Naming conventions
- Strategy slug: hyphenated (e.g., `beta-engine-60-40`).
- Versioned report: `YYYY-MM-DD_HH-MM_<strategy>.html` (UTC).
- Dashboard: `reports/index.html`.

## Guardrails
- Safe to modify: `scientist-workspace/`, `reports/`.
- Protected: `.git/`, `archive/`.

## Current known strategies
- `beta_engine_60_40` (alias: `beta-engine-60-40`).

## Safe extension procedure
1. Add strategy mapping/validation in `publish.py`.
2. Keep outputs deterministic and self-contained HTML.
3. Preserve index rule: filename timestamp is publish truth.
4. Avoid changing engine core unless explicitly required.
5. Validate local run before commit/push.


--- control/system_config.yaml ---

architecture_version: "1.0"
publication:
  reports_dir: "reports/"
  filename_format: "YYYY-MM-DD_HH-MM_<strategy>.html"
  index_source: "filename_timestamp"
  overwrite_allowed: false
  public_url_root: "https://bavvvy.github.io/agent-lab/reports/"
workflow:
  publish_script: "scientist-workspace/publish.py"
  index_regenerated_within_publish: true
guardrails:
  modifiable_paths:
    - "reports/"
    - "scientist-workspace/"
  protected_paths:
    - "archive/"
    - ".git/"
